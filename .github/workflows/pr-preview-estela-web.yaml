name: Build and Deploy estela-web
on:
  pull_request:

env:
  WEB_DIRECTORY: estela-web

jobs:
  check-web:
    runs-on: ubuntu-latest
    name: Test if web files changed
    outputs:
      web_changed: ${{ steps.changed-estela-web-files.outputs.any_changed }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Check if estela-web directory changed
        id: changed-estela-web-files
        uses: tj-actions/changed-files@v37
        with:
          files: estela-web

  check-api:
    runs-on: ubuntu-latest
    name: Test if api files changed
    outputs:
      api_changed: ${{ steps.changed-estela-api-files.outputs.any_changed }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Check if estela-api directory changed
        id: changed-estela-api-files
        uses: tj-actions/changed-files@v37
        with:
          files: estela-api

  build_web:
    if: needs.check-web.outputs.web_changed == 'true'
    name: Build web
    needs: [check-web, check-api]
    runs-on: ubuntu-latest
    env:
      web_changed: ${{ needs.check-web.outputs.web_changed }}
      api_changed: ${{ needs.check-api.outputs.api_changed }}
    steps:
      - name: Web changed
        run: |
          echo "estela-api changed status: ${{ env.api_changed }}"
          echo "estela-web changed status: ${{ env.web_changed }}!"
          echo "API URL: ${{ secrets.STAGING_BMC_API_URL }}"
